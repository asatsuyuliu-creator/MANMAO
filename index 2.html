<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç™¾å˜è›®çŒ« MANMAO - Dark Mode</title>
    <style>
        /* --- 1. å…¨å±€æ·±é‚ƒè®¾å®š --- */
        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'YouYuan', 'å¹¼åœ†', cursive, sans-serif;
            background-color: #050505; /* æå¤œé»‘ï¼Œä½œä¸ºcanvasåŠ è½½å‰çš„å…œåº• */
            color: #ecf0f1; /* é“¶ç°æ–‡å­— */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow-x: hidden;
            position: relative; /* ä¸º absolute å­å…ƒç´ æä¾›å®šä½åŸºå‡† */
        }

        /* --- æ–°å¢ï¼šèƒŒæ™¯ç²’å­ç”»å¸ƒ --- */
        #particle-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* ç½®äºæœ€åº•å±‚ */
            /* ç¡®ä¿é¼ æ ‡äº‹ä»¶èƒ½ç©¿é€ç”»å¸ƒä¼ ç»™ä¸Šé¢çš„æŒ‰é’® */
            pointer-events: none; 
        }

        #game-container {
            width: 100%;
            max-width: 450px;
            text-align: center;
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
        }

        /* --- 2. é¦–é¡µæ ‡é¢˜ --- */
        #start-screen {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .main-title-zh {
            font-size: 56px;
            font-weight: 900;
            color: #00f2ff; /* éœ“è™¹é’ */
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.8), 0 0 20px rgba(0, 242, 255, 0.4);
            margin-bottom: 15px;
            letter-spacing: 5px;
        }

        .sub-title-en {
            font-size: 24px;
            font-weight: bold;
            color: #050505;
            background-color: #00f2ff;
            font-family: 'Arial Rounded MT Bold', cursive;
            padding: 5px 20px;
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.5);
            letter-spacing: 4px;
            margin-bottom: 50px;
            text-transform: uppercase;
        }

        /* --- 3. å¸…æ°”æ§åˆ¶å°æŒ‰é’® (æ™¶ä½“é£æ ¼) --- */
        .btn {
            display: block;
            width: 100%;
            max-width: 320px; /* é¦–é¡µæŒ‰é’®ä¿æŒåŸæœ‰å®½åº¦ */
            padding: 18px 10px;
            font-size: 18px;
            margin: 20px auto;
            cursor: pointer;

            background: rgba(20, 20, 20, 0.6);
            border: 1px solid #00f2ff;
            color: #00f2ff;

            border-radius: 8px;
            font-family: inherit;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.1);
            backdrop-filter: blur(5px);
            box-sizing: border-box; /* ç¡®ä¿paddingä¸æ’‘å¤§å®½åº¦ */
        }

        .btn:hover, .btn:active {
            background: #00f2ff;
            color: #000;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.6);
            transform: scale(1.02);
        }

        #lang-btn {
            margin-top: 40px;
            border-color: #555;
            color: #888;
            font-size: 14px;
            padding: 10px;
            background: transparent;
            box-shadow: none;
        }
        #lang-btn:hover {
            border-color: #ecf0f1;
            color: #ecf0f1;
            background: rgba(255,255,255,0.1);
        }

        /* --- 4. é¢˜ç›®åŒºåŸŸå¸ƒå±€ä¿®æ­£ (å…³é”®ä¿®æ”¹) --- */
        /* ç»™é—®ç­”ç•Œé¢è®¾ç½®ä¸€ä¸ªå›ºå®šçš„æœ€å¤§å®½åº¦å®¹å™¨ï¼Œä¿è¯ä¸Šä¸‹å¯¹é½ */
        #quiz-screen {
            width: 100%;
            max-width: 340px; /* ç»Ÿä¸€å®½åº¦é™åˆ¶ */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #question-box {
            width: 100%; /* å æ»¡çˆ¶å®¹å™¨ (340px) */
            box-sizing: border-box; /* åŒ…å«padding */
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 25px;
            text-align: left;
            padding: 25px;

            background: rgba(15, 15, 15, 0.85);
            border: 1px solid #333;
            border-left: 5px solid #00f2ff;
            border-radius: 12px;

            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            color: #ecf0f1;
            font-weight: bold;
        }

        #options-box {
            width: 100%; /* å æ»¡çˆ¶å®¹å™¨ */
        }

        /* ç­”é¢˜é€‰é¡¹æŒ‰é’®å¾®è°ƒï¼šå¼ºåˆ¶å æ»¡å®½åº¦ï¼Œå»æ‰å·¦å³ margin */
        #quiz-screen .btn {
            max-width: 100%; /* è¦†ç›–å…¨å±€çš„320pxé™åˆ¶ï¼Œè·Ÿéšçˆ¶å®¹å™¨ */
            width: 100%;
            background: #111;
            border-color: #444;
            color: #bbb;
            margin: 12px 0; /* ä»…ä¿ç•™ä¸Šä¸‹é—´è· */
        }

        #quiz-screen .btn:hover {
            background: #00f2ff;
            color: #000;
        }

        /* --- 5. ç”»å¸ƒä¸ç»“æœ --- */
        canvas {
            width: 100%;
            height: auto;
            border: 2px solid #333;
            box-shadow: 0 0 40px rgba(0, 242, 255, 0.15);
            background-color: #000000;
            image-rendering: pixelated;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        #result-screen h2 {
            color: #00f2ff;
            text-shadow: 0 0 10px rgba(0,242,255,0.5);
        }
        #result-tags {
            margin-bottom: 20px;
            color: #555;
            letter-spacing: 2px;
            font-family: monospace;
        }

        .hidden { display: none !important; }
        .progress-text { color: #555; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

<canvas id="particle-canvas"></canvas>

<audio id="bgm" src="assets/bgm.mp3" loop preload="auto"></audio>

<div id="game-container">

    <div id="start-screen">
        <div class="main-title-zh" id="title-zh-text"></div>
        <div class="sub-title-en" id="title-en-text"></div>

        <button class="btn" id="start-btn-text" onclick="startGame()"></button>
        <button class="btn" id="lang-btn" onclick="toggleLanguage()">Switch to English</button>
    </div>

    <div id="quiz-screen" class="hidden">
        <div id="question-box">Loading System...</div>
        <div id="options-box"></div>
        <div class="progress-text">
            <span id="progress-label">SYNC</span>: <span id="progress">1</span> / 8
        </div>
    </div>

    <div id="result-screen" class="hidden">
        <h2 style="margin-top: 0;" id="result-title-text">âœ¨ ä½ çš„çµé­‚å½¢æ€ âœ¨</h2>

        <div id="loading" class="hidden" style="color: #666; margin: 20px;" id="loading-text">/// RENDERING...</div>

        <canvas id="catCanvas" width="1080" height="1920"></canvas>

        <div id="result-tags"></div>

        <button class="btn" id="download-btn-text" onclick="downloadImage()">ä¿å­˜é«˜æ¸…å£çº¸</button>
        <button class="btn" id="replay-btn-text" style="border-style: dashed; opacity: 0.7;" onclick="location.reload()">å†æµ‹ä¸€æ¬¡</button>
    </div>
</div>

<script>
    // ==========================================
    // 0. ğŸŒ å¤šè¯­è¨€æ•°æ®ä¸­å¿ƒ
    // ==========================================
    let currentLang = 'zh'; // é»˜è®¤ä¸­æ–‡

    const uiText = {
        zh: {
            titleZH: "ç™¾å˜è›®çŒ«",
            titleEN: "MANMAO",
            startBtn: "å¯åŠ¨æµ‹è¯•",
            langBtn: "Switch to English",
            progressLabel: "è¿›åº¦",
            resultTitle: "âœ¨ çµé­‚å½¢æ€è§£æå®Œæˆ âœ¨",
            loading: "/// æ­£åœ¨ç»˜åˆ¶é«˜æ¸…å›¾å±‚...",
            downloadBtn: "ä¸‹è½½é«˜æ¸…æ¡£æ¡ˆ",
            replayBtn: "é‡æ–°åŒæ­¥"
        },
        en: {
            titleZH: "MANMAO",
            titleEN: "PROJECT",
            startBtn: "INITIATE",
            langBtn: "åˆ‡æ¢åˆ°ä¸­æ–‡",
            progressLabel: "SYNC",
            resultTitle: "âœ¨ SOUL FORM ANALYZED âœ¨",
            loading: "/// RENDERING HIGH-RES...",
            downloadBtn: "DOWNLOAD ARCHIVE",
            replayBtn: "RE-SYNC"
        }
    };

    // ğŸµ éŸ³ä¹é€»è¾‘
    function playMusic() {
        var audio = document.getElementById("bgm");
        var playPromise = audio.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => { console.log("Waiting for interaction..."); });
        }
    }
    // window.onload åœ¨åé¢ç»Ÿä¸€å¤„ç†

    // ğŸŒ åˆ‡æ¢è¯­è¨€
    function toggleLanguage() {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        updateUIText();
        if (!document.getElementById('quiz-screen').classList.contains('hidden')) {
            showQuestion();
        }
    }

    function updateUIText() {
        const t = uiText[currentLang];
        document.getElementById('title-zh-text').textContent = t.titleZH;
        document.getElementById('title-en-text').textContent = t.titleEN;
        document.getElementById('start-btn-text').textContent = t.startBtn;
        document.getElementById('lang-btn').textContent = t.langBtn;
        document.getElementById('progress-label').textContent = t.progressLabel;
        document.getElementById('result-title-text').textContent = t.resultTitle;
        document.getElementById('loading-text').textContent = t.loading;
        document.getElementById('download-btn-text').textContent = t.downloadBtn;
        document.getElementById('replay-btn-text').textContent = t.replayBtn;
    }

    // ==========================================
    // 1. ç´ æåº“é…ç½®
    // ==========================================
    const rawAssetList = [
        "bg_Magic_01.png", "bg_Nature_01.png", "bg_Dark_01.png", "bg_Cute_01.png",
        "bg_Tech_01.png", "bg_Retro_01.png", "bg_Dream_01.png", "bg_Ocean_01.png",

        "skin_Magic_01.png", "skin_Magic_02.png", "skin_Nature_01.png", "skin_Nature_02.png",
        "skin_Dark_01.png", "skin_Dark_02.png", "skin_Cute_01.png", "skin_Cute_02.png",
        "skin_Tech_01.png", "skin_Retro_01.png", "skin_Dream_01.png", "skin_Ocean_01.png",

        "wing_Magic_01.png", "wing_Magic_02.png", "wing_Magic_03.png",
        "wing_Nature_01.png", "wing_Nature_02.png",
        "wing_Dark_01.png", "wing_Dark_02.png", "wing_Cute_01.png", "wing_Cute_02.png",
        "wing_Tech_01.png", "wing_Tech_02.png", "wing_Retro_01.png", "wing_Retro_02.png",
        "wing_Dream_01.png", "wing_Ocean_01.png",

        "hat_Magic_01.png", "hat_Nature_01.png", "hat_Dark_01.png", "hat_Cute_01.png",
        "hat_Tech_01.png", "hat_Retro_01.png", "hat_Dream_01.png", "hat_Ocean_01.png",

        "tie_Magic_01.png", "tie_Nature_01.png", "tie_Dark_01.png", "tie_Cute_01.png",
        "tie_Tech_01.png", "tie_Retro_01.png", "tie_Dream_01.png", "tie_Ocean_01.png"
    ];

    // ==========================================
    // 2. é¢˜ç›®é…ç½® (åŒè¯­)
    // ==========================================
    const questionsData = [
        {
            zh: {
                text: "1. å½“ä½ è¿›å…¥ä¸€ä¸ªåƒç´ æ£®æ—ï¼Œä½ ä¼šçœ‹åˆ°ä»€ä¹ˆæ ·çš„åœºæ™¯ï¼Ÿ",
                options: [
                    { text: "A. å‘å…‰çš„ç¥ç§˜ç¬¦æ–‡", tag: "Magic" },
                    { text: "B. å››å‘¨çº·é£çš„è¤ç«è™«", tag: "Nature" },
                    { text: "C. è¿œå¤„é—ªäº®çš„å°å±‹", tag: "Cute" },
                    { text: "D. åºŸå¼ƒçš„å¤è€å¢“ç¢‘", tag: "Dark" }
                ]
            },
            en: {
                text: "1. Entering a pixel forest, what catches your eye?",
                options: [
                    { text: "A. Glowing mystic runes", tag: "Magic" },
                    { text: "B. Floating fireflies everywhere", tag: "Nature" },
                    { text: "C. A cozy shining hut nearby", tag: "Cute" },
                    { text: "D. Abandoned ancient tombstones", tag: "Dark" }
                ]
            }
        },
        {
            zh: {
                text: "2. ä½ å¸Œæœ›æ‹¥æœ‰ä¸€ç§ä»€ä¹ˆæ ·çš„ç‰¹æ®Šèƒ½åŠ›ï¼Ÿ",
                options: [
                    { text: "A. æ“æ§ç”µå­æ•°æ®", tag: "Tech" },
                    { text: "B. æ—¶é—´å€’æµ", tag: "Retro" },
                    { text: "C. æ“æ§æ½®æ±", tag: "Ocean" },
                    { text: "D. ç¼–ç»‡æ¢¦å¢ƒ", tag: "Dream" }
                ]
            },
            en: {
                text: "2. What special ability do you desire most?",
                options: [
                    { text: "A. Manipulate digital data", tag: "Tech" },
                    { text: "B. Reverse time flow", tag: "Retro" },
                    { text: "C. Control the tides", tag: "Ocean" },
                    { text: "D. Weave dreams together", tag: "Dream" }
                ]
            }
        },
        {
            zh: {
                text: "3. ä½ çš„çŒ«å’ªå¦‚æœä¸æŠ“è€é¼ ï¼Œå®ƒä¼šå–œæ¬¢æ”¶é›†ä»€ä¹ˆï¼Ÿ",
                options: [
                    { text: "A. é­”æ³•è¯æ°´ç“¶", tag: "Magic" },
                    { text: "B. å¥‡æ€ªçš„èºä¸é’‰", tag: "Tech" },
                    { text: "C. å½©è‰²çš„è´å£³", tag: "Ocean" },
                    { text: "D. æ£®æ—é‡Œçš„å¹²èŠ±", tag: "Nature" }
                ]
            },
            en: {
                text: "3. Instead of mice, what does your cat collect?",
                options: [
                    { text: "A. Magic potion bottles", tag: "Magic" },
                    { text: "B. Strange rusty screws", tag: "Tech" },
                    { text: "C. Colorful seashells", tag: "Ocean" },
                    { text: "D. Dried forest flowers", tag: "Nature" }
                ]
            }
        },
        {
            zh: {
                text: "4. å‘¨æœ«çš„åˆåï¼Œä½ æœ€æƒ³åœ¨å“ªé‡Œåº¦è¿‡ï¼Ÿ",
                options: [
                    { text: "A. äº‘ç«¯çš„åŸå ¡", tag: "Dream" },
                    { text: "B. å……æ»¡éœ“è™¹ç¯çš„è¡—é“", tag: "Tech" },
                    { text: "C. å®‰é™çš„è€å›¾ä¹¦é¦†", tag: "Retro" },
                    { text: "D. æ¸©æš–çš„è¢«çªé‡Œ", tag: "Cute" }
                ]
            },
            en: {
                text: "4. Where would you spend a Sunday afternoon?",
                options: [
                    { text: "A. Castle in the clouds", tag: "Dream" },
                    { text: "B. Neon-lit cyberpunk streets", tag: "Tech" },
                    { text: "C. Quiet old library", tag: "Retro" },
                    { text: "D. Warm cozy blanket", tag: "Cute" }
                ]
            }
        },
        {
            zh: {
                text: "5. å¦‚æœé‡åˆ°å±é™©ï¼Œä½ çš„çŒ«å’ªä¼šæ€ä¹ˆåšï¼Ÿ",
                options: [
                    { text: "A. æ½œå…¥é˜´å½±ä¸­æ¶ˆå¤±", tag: "Dark" },
                    { text: "B. å¬å”¤è—¤è”“é˜²å¾¡", tag: "Nature" },
                    { text: "C. å‘å°„æ¿€å…‰å°„çº¿", tag: "Tech" },
                    { text: "D. æ–½å±•é˜²å¾¡ç»“ç•Œ", tag: "Magic" }
                ]
            },
            en: {
                text: "5. In danger, how does your cat react?",
                options: [
                    { text: "A. Vanish into shadows", tag: "Dark" },
                    { text: "B. Summon vines to block", tag: "Nature" },
                    { text: "C. Fire laser beams", tag: "Tech" },
                    { text: "D. Cast a defensive shield", tag: "Magic" }
                ]
            }
        },
        {
            zh: {
                text: "6. ä½ æœ€å–œæ¬¢çš„é¢œè‰²é£æ ¼æ˜¯ï¼Ÿ",
                options: [
                    { text: "A. æ·±é‚ƒçš„é»‘ç´«", tag: "Dark" },
                    { text: "B. æŸ”å’Œçš„ç²‰ç™½", tag: "Cute" },
                    { text: "C. æ€€æ—§çš„æ£•é»„", tag: "Retro" },
                    { text: "D. æ¸…æ–°çš„æµ·è“", tag: "Ocean" }
                ]
            },
            en: {
                text: "6. What is your favorite color palette?",
                options: [
                    { text: "A. Deep black and purple", tag: "Dark" },
                    { text: "B. Soft pink and white", tag: "Cute" },
                    { text: "C. Nostalgic sepia", tag: "Retro" },
                    { text: "D. Fresh ocean blue", tag: "Ocean" }
                ]
            }
        },
        {
            zh: {
                text: "7. ä½ çš„çŒ«å’ªå¦‚æœä¼šè¯´è¯ï¼Œå®ƒçš„å£°éŸ³å¬èµ·æ¥åƒï¼Ÿ",
                options: [
                    { text: "A. åƒé£é“ƒä¸€æ ·ç©ºçµ", tag: "Dream" },
                    { text: "B. åƒæµ·æµªä¸€æ ·æ·±æ²‰", tag: "Ocean" },
                    { text: "C. åƒæ”¶éŸ³æœºé‡Œçš„æ‚éŸ³", tag: "Retro" },
                    { text: "D. åƒå°å­©å­ä¸€æ ·è½¯èŒ", tag: "Cute" }
                ]
            },
            en: {
                text: "7. If your cat could speak, it would sound like...",
                options: [
                    { text: "A. Ethereal wind chimes", tag: "Dream" },
                    { text: "B. Deep ocean waves", tag: "Ocean" },
                    { text: "C. Old radio static", tag: "Retro" },
                    { text: "D. Cute childish voice", tag: "Cute" }
                ]
            }
        },
        {
            zh: {
                text: "8. æ—…é€”çš„ç»ˆç‚¹ï¼Œä½ å¸Œæœ›è·å¾—ä»€ä¹ˆï¼Ÿ",
                options: [
                    { text: "A. æ— å°½çš„çŸ¥è¯†", tag: "Magic" },
                    { text: "B. æ°¸æ’çš„å¹³é™", tag: "Nature" },
                    { text: "C. ç»å¯¹çš„åŠ›é‡", tag: "Dark" },
                    { text: "D. è™šå¹»çš„è‡ªç”±", tag: "Dream" }
                ]
            },
            en: {
                text: "8. At the journey's end, what do you seek?",
                options: [
                    { text: "A. Infinite knowledge", tag: "Magic" },
                    { text: "B. Eternal peace", tag: "Nature" },
                    { text: "C. Absolute power", tag: "Dark" },
                    { text: "D. Illusory freedom", tag: "Dream" }
                ]
            }
        }
    ];

    // ==========================================
    // 3. æ ¸å¿ƒé€»è¾‘
    // ==========================================
    let currentQ = 0;
    let tagScores = {};
    let parsedAssets = { bg: {}, skin: {}, wing: {}, tie: {}, hat: {} };

    function initDatabase() {
        rawAssetList.forEach(filename => {
            const parts = filename.split('_');
            if (parts.length < 3) return;
            const category = parts[0];
            const tag = parts[1];
            if (parsedAssets[category]) {
                if (!parsedAssets[category][tag]) {
                    parsedAssets[category][tag] = [];
                }
                parsedAssets[category][tag].push(filename);
            }
        });
        console.log("Database Ready");
    }

    function startGame() {
        playMusic();
        initDatabase();
        tagScores = {};
        const allTags = ["Magic", "Nature", "Dark", "Cute", "Tech", "Retro", "Dream", "Ocean"];
        allTags.forEach(t => tagScores[t] = 0);

        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        currentQ = 0;
        showQuestion();
    }

    function showQuestion() {
        const qData = questionsData[currentQ];
        const q = qData[currentLang];

        document.getElementById('question-box').textContent = q.text;
        document.getElementById('progress').textContent = currentQ + 1;

        const optsDiv = document.getElementById('options-box');
        optsDiv.innerHTML = '';

        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = opt.text;
            btn.onclick = () => handleAnswer(opt.tag);
            optsDiv.appendChild(btn);
        });
    }

    function handleAnswer(tag) {
        if (tagScores[tag] !== undefined) tagScores[tag]++;
        currentQ++;
        if (currentQ < questionsData.length) showQuestion();
        else generateCat();
    }

    function generateCat() {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('loading').classList.remove('hidden');

        const sortedTags = Object.entries(tagScores).sort((a, b) => b[1] - a[1]);
        const mainTag = sortedTags[0][0];
        const subTag = sortedTags[1] ? sortedTags[1][0] : mainTag;

        document.getElementById('result-tags').textContent = `CODE: ${mainTag} / ${subTag}`;

        const outfit = {
            bg:   pickAsset('bg', mainTag, subTag),
            skin: pickAsset('skin', mainTag, subTag),
            wing: pickAsset('wing', mainTag, subTag),
            tie:  pickAsset('tie', mainTag, subTag),
            hat:  pickAsset('hat', mainTag, subTag)
        };

        drawCat(outfit);
    }

    function pickAsset(category, mainTag, subTag) {
        const categoryPool = parsedAssets[category];
        if (!categoryPool) return null;
        let candidates = categoryPool[mainTag];
        if (!candidates || candidates.length === 0) candidates = categoryPool[subTag];
        if (!candidates || candidates.length === 0) {
            const allTags = Object.keys(categoryPool);
            candidates = categoryPool[allTags[Math.floor(Math.random() * allTags.length)]];
        }
        const choice = candidates[Math.floor(Math.random() * candidates.length)];
        return `assets/${choice}`;
    }

    function drawCat(outfit) {
        // æ³¨æ„ï¼šè¿™é‡Œæ˜¯ç”»çŒ«çš„canvasï¼Œä¸æ˜¯èƒŒæ™¯
        const ctx = document.getElementById('catCanvas').getContext('2d');
        ctx.fillStyle = "#000000";
        ctx.fillRect(0, 0, 1080, 1920);

        const layerOrder = [outfit.bg, outfit.wing, outfit.skin, outfit.tie, outfit.hat];

        const promises = layerOrder.map(src => new Promise(resolve => {
            if (!src) { resolve(null); return; }
            const img = new Image();
            img.onload = () => resolve(img);
            img.onerror = () => { console.error("Missing:", src); resolve(null); };
            img.src = src;
        }));

        Promise.all(promises).then(images => {
            images.forEach((img, index) => {
                if (img) {
                    if (index === 0) {
                        ctx.save();
                        ctx.globalAlpha = 0.7;
                        ctx.drawImage(img, 0, 0, 1080, 1920);
                        ctx.restore();
                    } else {
                        ctx.drawImage(img, 0, 0, 1080, 1920);
                    }
                }
            });
            document.getElementById('loading').classList.add('hidden');
        });
    }

    function downloadImage() {
        const canvas = document.getElementById('catCanvas');
        const link = document.createElement('a');
        link.download = 'My_ManMao.png';
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
    }
</script>

<script>
(function() {
    const canvas = document.getElementById('particle-canvas');
    const ctx = canvas.getContext('2d');
    let w, h, centerX, centerY;
    let particles = [];
    const particleCount = 350; // ç²’å­æ•°é‡

    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
        centerX = w / 2;
        centerY = h / 2;
    }

    class Particle {
        constructor() {
            this.reset();
        }
        reset() {
            // åˆå§‹ä½ç½®åœ¨ä¸­å¿ƒé™„è¿‘éšæœºåˆ†å¸ƒ
            this.angle = Math.random() * Math.PI * 2;
            this.radius = Math.random() * 200; 
            this.x = centerX + Math.cos(this.angle) * this.radius;
            this.y = centerY + Math.sin(this.angle) * this.radius;
            
            // é€Ÿåº¦å’Œå¤§å°
            this.speed = 0.002 + Math.random() * 0.004; // æ—‹è½¬é€Ÿåº¦
            this.radialSpeed = 0.3 + Math.random() * 0.5; // å‘å¤–æ‰©æ•£é€Ÿåº¦
            this.size = Math.random() * 2 + 0.5;
            
            // è“ç°è‰²ç²’å­ï¼Œä½é€æ˜åº¦
            const blue = Math.floor(150 + Math.random() * 50);
            const grey = Math.floor(100 + Math.random() * 50);
            this.color = `rgba(${grey}, ${grey+20}, ${blue}, ${Math.random() * 0.3 + 0.1})`;
        }
        update() {
            this.angle += this.speed;
            this.radius += this.radialSpeed;
            this.x = centerX + Math.cos(this.angle) * this.radius;
            this.y = centerY + Math.sin(this.angle) * this.radius;

            // å¦‚æœè¶…å‡ºå±å¹•èŒƒå›´ï¼Œé‡ç½®åˆ°ä¸­å¿ƒ
            const maxRadius = Math.sqrt(w*w + h*h) / 1.5;
            if (this.radius > maxRadius) {
                 this.reset();
                 this.radius = Math.random() * 50; // é‡ç½®æ—¶ç¦»ä¸­å¿ƒè¿‘ä¸€ç‚¹
            }
        }
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
        }
    }

    function init() {
        resize();
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }
        animate();
    }

    function animate() {
        // å…³é”®ï¼šé€šè¿‡è¦†ç›–åŠé€æ˜èƒŒæ™¯æ¥å®ç°é•¿å°¾æµæ•ˆæœ
        // è¿™é‡Œçš„é¢œè‰²éœ€è¦ä¸ body çš„èƒŒæ™¯è‰² (#050505) æ¥è¿‘
        ctx.fillStyle = 'rgba(5, 5, 5, 0.08)'; 
        ctx.fillRect(0, 0, w, h);

        particles.forEach(p => {
            p.update();
            p.draw();
        });
        requestAnimationFrame(animate);
    }

    window.addEventListener('resize', resize);

    // æ•´åˆåŸæœ‰çš„ window.onload
    const originalOnload = window.onload;
    window.onload = function() {
        if (originalOnload) originalOnload();
        init(); // å¯åŠ¨ç²’å­ç³»ç»Ÿ
        updateUIText(); // åˆå§‹åŒ–UIæ–‡æœ¬
    };
})();
</script>

</body>
</html>